{
  "hash": "124b0d3dd209112d029fc42589fab198",
  "result": {
    "markdown": "---\ntitle: \"Running Moire Example\"\noutput: html_document\n---\n\n\n\n\n## The data\n\nIn this analysis we will be using the SNP barcode data from the sanger 100 SNP Plasmodium falciparum barcode [(Chang et al. 2019)]( https://doi.org/10.7554/eLife.43481). \nThis was generated by subsetting the WGS data (also described within the [Data section](../../website_docs/data_description.qmd) of this website) and we will be using the data from the DRC. \nSee the description in the [Data section](../../website_docs/data_description.qmd) for more details on this dataset.\n\nMoire requires input data in either long or wide format, which can be loaded using the `load_long_form_data()` or `load_delimited_data()` functions, respectively. The long format represents data with each observation on a separate row, while the wide format uses a separate column for each variable. In the following steps, we will convert the Variant Call Format (VCF) data to the required long format using ...\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\n```\n:::\n\n\n## Running the MCMC \n\nNow that we have the data in the correct format we will run the Markov chain Monte Carlo (MCMC) with the default parameters:\n\n\n::: {.cell hash='Template_analysis_cache/html/mcmc_4573cb2fcdc4afe95c06d1a312d43d2f'}\n\n```{.r .cell-code}\n# mcmc_results <- moire::run_mcmc(data, is_missing = data$is_missing)\nmcmc_results <- moire::mcmc_results\n```\n:::\n\n\n## Summarising the results \n\nFrom the MCMC results we can produce estimations for each sample and summarise the results. \n\nFirst we will look at COI using `summarize_coi`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Estimate the COI for each sample\ncoi_summary <- moire::summarize_coi(mcmc_results)\n\nhead(coi_summary) |>\n  kable() |>\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> sample_id </th>\n   <th style=\"text-align:right;\"> post_coi_lower </th>\n   <th style=\"text-align:right;\"> post_coi_med </th>\n   <th style=\"text-align:right;\"> post_coi_upper </th>\n   <th style=\"text-align:right;\"> post_coi_mean </th>\n   <th style=\"text-align:right;\"> naive_coi </th>\n   <th style=\"text-align:right;\"> offset_naive_coi </th>\n   <th style=\"text-align:right;\"> prob_polyclonal </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> S1 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 2.000 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S2 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 4.000 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S3 </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 7.005 </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S4 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 5.001 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S5 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 3.000 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S6 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 2.000 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThis dataframe includes summaries of both the posterior distribution of COI for each biological sample and the naive estimates.\n\nBelow we use the `summarize_he` function to summarise locus heterozygosity from the posterior distribution of sampled allele frequencies.\n\n::: {.cell}\n\n```{.r .cell-code}\nhe_summary <- moire::summarize_he(mcmc_results)\n\nhead(he_summary) |>\n  kable() |>\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> locus </th>\n   <th style=\"text-align:right;\"> post_stat_lower </th>\n   <th style=\"text-align:right;\"> post_stat_med </th>\n   <th style=\"text-align:right;\"> post_stat_upper </th>\n   <th style=\"text-align:right;\"> post_stat_mean </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> L1 </td>\n   <td style=\"text-align:right;\"> 0.4653153 </td>\n   <td style=\"text-align:right;\"> 0.5251785 </td>\n   <td style=\"text-align:right;\"> 0.5785077 </td>\n   <td style=\"text-align:right;\"> 0.5242425 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> L2 </td>\n   <td style=\"text-align:right;\"> 0.5313903 </td>\n   <td style=\"text-align:right;\"> 0.5790735 </td>\n   <td style=\"text-align:right;\"> 0.6192777 </td>\n   <td style=\"text-align:right;\"> 0.5779145 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> L3 </td>\n   <td style=\"text-align:right;\"> 0.7200378 </td>\n   <td style=\"text-align:right;\"> 0.7438508 </td>\n   <td style=\"text-align:right;\"> 0.7623757 </td>\n   <td style=\"text-align:right;\"> 0.7430718 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> L4 </td>\n   <td style=\"text-align:right;\"> 0.7195991 </td>\n   <td style=\"text-align:right;\"> 0.7363118 </td>\n   <td style=\"text-align:right;\"> 0.7486111 </td>\n   <td style=\"text-align:right;\"> 0.7359094 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> L5 </td>\n   <td style=\"text-align:right;\"> 0.7226981 </td>\n   <td style=\"text-align:right;\"> 0.7414487 </td>\n   <td style=\"text-align:right;\"> 0.7550329 </td>\n   <td style=\"text-align:right;\"> 0.7408486 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> L6 </td>\n   <td style=\"text-align:right;\"> 0.4330627 </td>\n   <td style=\"text-align:right;\"> 0.4922349 </td>\n   <td style=\"text-align:right;\"> 0.5509750 </td>\n   <td style=\"text-align:right;\"> 0.4925207 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nUsing `summarize_allele_freqs` we can look at individual allele frequencies\n\n::: {.cell}\n\n```{.r .cell-code}\nallele_freq_summary <- moire::summarize_allele_freqs(mcmc_results)\n\nhead(allele_freq_summary) |>\n  kable() |>\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> post_allele_freqs_lower </th>\n   <th style=\"text-align:right;\"> post_allele_freqs_med </th>\n   <th style=\"text-align:right;\"> post_allele_freqs_upper </th>\n   <th style=\"text-align:right;\"> post_allele_freqs_mean </th>\n   <th style=\"text-align:left;\"> locus </th>\n   <th style=\"text-align:left;\"> allele </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> L1.1 </td>\n   <td style=\"text-align:right;\"> 0.0091121 </td>\n   <td style=\"text-align:right;\"> 0.0195682 </td>\n   <td style=\"text-align:right;\"> 0.0384624 </td>\n   <td style=\"text-align:right;\"> 0.0206277 </td>\n   <td style=\"text-align:left;\"> L1 </td>\n   <td style=\"text-align:left;\"> L1_1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> L1.2 </td>\n   <td style=\"text-align:right;\"> 0.0595928 </td>\n   <td style=\"text-align:right;\"> 0.0878980 </td>\n   <td style=\"text-align:right;\"> 0.1207504 </td>\n   <td style=\"text-align:right;\"> 0.0880891 </td>\n   <td style=\"text-align:left;\"> L1 </td>\n   <td style=\"text-align:left;\"> L1_2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> L1.3 </td>\n   <td style=\"text-align:right;\"> 0.1145909 </td>\n   <td style=\"text-align:right;\"> 0.1540206 </td>\n   <td style=\"text-align:right;\"> 0.1964562 </td>\n   <td style=\"text-align:right;\"> 0.1540618 </td>\n   <td style=\"text-align:left;\"> L1 </td>\n   <td style=\"text-align:left;\"> L1_3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> L1.4 </td>\n   <td style=\"text-align:right;\"> 0.0507137 </td>\n   <td style=\"text-align:right;\"> 0.0755516 </td>\n   <td style=\"text-align:right;\"> 0.1054745 </td>\n   <td style=\"text-align:right;\"> 0.0766994 </td>\n   <td style=\"text-align:left;\"> L1 </td>\n   <td style=\"text-align:left;\"> L1_4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> L1.5 </td>\n   <td style=\"text-align:right;\"> 0.6081076 </td>\n   <td style=\"text-align:right;\"> 0.6606527 </td>\n   <td style=\"text-align:right;\"> 0.7131484 </td>\n   <td style=\"text-align:right;\"> 0.6605220 </td>\n   <td style=\"text-align:left;\"> L1 </td>\n   <td style=\"text-align:left;\"> L1_5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> L2.1 </td>\n   <td style=\"text-align:right;\"> 0.0024597 </td>\n   <td style=\"text-align:right;\"> 0.0087402 </td>\n   <td style=\"text-align:right;\"> 0.0215203 </td>\n   <td style=\"text-align:right;\"> 0.0095781 </td>\n   <td style=\"text-align:left;\"> L2 </td>\n   <td style=\"text-align:left;\"> L2_1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThe `summarize_relatedness` function provides a dataframe of within-host relatedness\n\n::: {.cell}\n\n```{.r .cell-code}\nrelatedness_summary <- moire::summarize_relatedness(mcmc_results)\n\nhead(relatedness_summary) |>\n  kable() |>\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> sample_id </th>\n   <th style=\"text-align:right;\"> post_relatedness_lower </th>\n   <th style=\"text-align:right;\"> post_relatedness_med </th>\n   <th style=\"text-align:right;\"> post_relatedness_upper </th>\n   <th style=\"text-align:right;\"> post_relatedness_mean </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> S1 </td>\n   <td style=\"text-align:right;\"> 0.1816463 </td>\n   <td style=\"text-align:right;\"> 0.2997016 </td>\n   <td style=\"text-align:right;\"> 0.4375144 </td>\n   <td style=\"text-align:right;\"> 0.3036319 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S2 </td>\n   <td style=\"text-align:right;\"> 0.0233785 </td>\n   <td style=\"text-align:right;\"> 0.0779307 </td>\n   <td style=\"text-align:right;\"> 0.1462287 </td>\n   <td style=\"text-align:right;\"> 0.0800967 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S3 </td>\n   <td style=\"text-align:right;\"> 0.0004173 </td>\n   <td style=\"text-align:right;\"> 0.0126082 </td>\n   <td style=\"text-align:right;\"> 0.0576522 </td>\n   <td style=\"text-align:right;\"> 0.0174901 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S4 </td>\n   <td style=\"text-align:right;\"> 0.0010905 </td>\n   <td style=\"text-align:right;\"> 0.0209472 </td>\n   <td style=\"text-align:right;\"> 0.0735356 </td>\n   <td style=\"text-align:right;\"> 0.0259131 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S5 </td>\n   <td style=\"text-align:right;\"> 0.0320406 </td>\n   <td style=\"text-align:right;\"> 0.0919202 </td>\n   <td style=\"text-align:right;\"> 0.1793761 </td>\n   <td style=\"text-align:right;\"> 0.0964040 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S6 </td>\n   <td style=\"text-align:right;\"> 0.0003879 </td>\n   <td style=\"text-align:right;\"> 0.0168089 </td>\n   <td style=\"text-align:right;\"> 0.0783448 </td>\n   <td style=\"text-align:right;\"> 0.0227718 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThe *moire* tool introduces a new metric called effective MOI, which adjusts for within-host relatedness. A detailed description of this metric and how to interpret it can be found [here](https://eppicenter.github.io/moire/articles/mcmc_demo.html#what-is-effective-coi).\n\n::: {.cell}\n\n```{.r .cell-code}\neffective_coi_summary <- moire::summarize_effective_coi(mcmc_results)\n\nhead(effective_coi_summary) |>\n  kable() |>\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> sample_id </th>\n   <th style=\"text-align:right;\"> post_effective_coi_lower </th>\n   <th style=\"text-align:right;\"> post_effective_coi_med </th>\n   <th style=\"text-align:right;\"> post_effective_coi_upper </th>\n   <th style=\"text-align:right;\"> post_effective_coi_mean </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> S1 </td>\n   <td style=\"text-align:right;\"> 1.562486 </td>\n   <td style=\"text-align:right;\"> 1.700298 </td>\n   <td style=\"text-align:right;\"> 1.818354 </td>\n   <td style=\"text-align:right;\"> 1.696368 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S2 </td>\n   <td style=\"text-align:right;\"> 3.561314 </td>\n   <td style=\"text-align:right;\"> 3.766208 </td>\n   <td style=\"text-align:right;\"> 3.929865 </td>\n   <td style=\"text-align:right;\"> 3.759710 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S3 </td>\n   <td style=\"text-align:right;\"> 6.668518 </td>\n   <td style=\"text-align:right;\"> 6.924888 </td>\n   <td style=\"text-align:right;\"> 6.998033 </td>\n   <td style=\"text-align:right;\"> 6.899518 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S4 </td>\n   <td style=\"text-align:right;\"> 4.708910 </td>\n   <td style=\"text-align:right;\"> 4.916394 </td>\n   <td style=\"text-align:right;\"> 4.995703 </td>\n   <td style=\"text-align:right;\"> 4.897161 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S5 </td>\n   <td style=\"text-align:right;\"> 2.641248 </td>\n   <td style=\"text-align:right;\"> 2.816160 </td>\n   <td style=\"text-align:right;\"> 2.935919 </td>\n   <td style=\"text-align:right;\"> 2.807192 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S6 </td>\n   <td style=\"text-align:right;\"> 1.921655 </td>\n   <td style=\"text-align:right;\"> 1.983191 </td>\n   <td style=\"text-align:right;\"> 1.999612 </td>\n   <td style=\"text-align:right;\"> 1.977228 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Summary\n\nIn summary, *moire* estimates allele frequencies, MOI, and within-host relatedness. We have shown how to generate basic results from a VCF. Moire has extensive [documentation](https://eppicenter.github.io/moire/index.html), including more details on [other functionality](https://eppicenter.github.io/moire/articles/mcmc_demo.html#estimating-allele-frequencies) available within the tool and a [tutorial](https://eppicenter.github.io/moire/articles/mcmc_demo.html#estimating-allele-frequencies) validating the outputs using simulated data.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}